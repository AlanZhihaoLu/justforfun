<html>
    <head>
        <title>
            Morse Interpreter
        </title>
        <style>
            body {
                touch-action: manipulation;
            }
            button {
                transition-duration: 0.4s;
            }
            .del-button:hover {
                background-color: whitesmoke;
                color: red;
            }
            .cal-button:hover {
                background-color: black;
                color: whitesmoke;
            }
            .unselectable {
                -webkit-user-select: none; /* Safari */        
                -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* IE10+/Edge */
                user-select: none; /* Standard */
            }
            .del-button {
                border: 1vw solid red;
                border-radius: 1vw;
                background-color: red;
                color: whitesmoke;
                padding: 1vw;
                cursor: pointer;
            }
            .cal-button {
                border: 0.5vw solid black;
                border-radius: 0.5vw;
                background-color: whitesmoke;
                color: black;
                padding: 0.5vw;
                cursor: pointer;
            }
            .inputarea {
                border: 1vw solid black;
                border-radius: 1vw;
                overflow: auto;
                resize: both;
            }
        </style>
    </head>
    <body>
        <button class="cal-button unselectable" style="font-size:5vh;">calibrate</button>
        <div class="unselectable" style="display:flex;justify-content:center;align-items:center;height:25vh;font-size:10vh;">
            Morse Interpreter
        </div>
        <div>
            <div class="unselectable inputarea" style="display:flex;justify-content:center;align-items:center;height:20vh;font-size:10vh;">
                <span>
                    <span id="interpreted" style='white-space:pre-wrap;'></span>
                    <span id="ditdahs" style='opacity:0.5;margin-left:-0.1em;'></span>
                    <span id="cursor" style='position:relative;font-size:1.2em;top:0.05em;margin-left:-0.1em;'>|</span>
                </span>
            </div>
            <div style="display:flex;justify-content:center;align-items:flex-end;height:20vh;">
                <button class="del-button unselectable" style="font-size:10vh;">delete</button>
            </div>
        </div>
    </body>
    <script src="cursor_blink.js"></script>
    <script src="delete_button.js"></script>
    <script>
        var interpreted = document.querySelector('#interpreted');
        var ditdahs = document.querySelector('#ditdahs');

        var morse_dict = {
            '.-':'a',
            '-...':'b',
            '-.-.':'c',
            '-..':'d',
            '.':'e',
            '..-.':'f',
            '--.':'g',
            '....':'h',
            '..':'i',
            '.---':'j',
            '-.-':'k',
            '.-..':'l',
            '--':'m',
            '-.':'n',
            '---':'o',
            '.--.':'p',
            '--.-':'q',
            '.-.':'r',
            '...':'s',
            '-':'t',
            '..-':'u',
            '...-':'v',
            '.--':'w',
            '-..-':'x',
            '-.--':'y',
            '--..':'z',
            '.----':'1',
            '..---':'2',
            '...--':'3',
            '....-':'4',
            '.....':'5',
            '-....':'6',
            '--...':'7',
            '---..':'8',
            '----.':'9',
            '-----':'0'
        }

        var dit = 150;
        ditdahs.innerHTML = '';
        var timeoutID;

        var ready_down = true;
        var t0;
        var dur;

        document.body.addEventListener('mousedown', function (e) {
            if (ready_down) {
                t0 = e.timeStamp;
                if (timeoutID !== undefined) {
                    clearTimeout(timeoutID);
                }
                ready_down = false;
            }
        })
        document.body.addEventListener('mouseup', function(e) {
            if (t0 !== undefined) {
                dur = e.timeStamp - t0;
                if (dur < (dit*2.5)) {
                    ditdahs.innerHTML = ditdahs.innerHTML + '.';
                } else {
                    ditdahs.innerHTML = ditdahs.innerHTML + '-';
                };
                timeoutID = setTimeout(interpret_morse,dit*3);
                ready_down = true;
            }
        })

        document.body.addEventListener('keydown', function (e) {
            if (e.keyCode === 8) {
                if (timeoutID !== undefined) {
                    clearTimeout(timeoutID);
                    if (ditdahs.innerHTML.length !== 0) {
                        timeoutID = setTimeout(interpret_morse,dit*3);
                        ditdahs.innerHTML = ditdahs.innerHTML.slice(0, -1);
                    } else {
                        interpreted.innerHTML = interpreted.innerHTML.slice(0, -1);
                    }
                }
            }
            if (e.keyCode === 32 && ready_down) {
                t0 = e.timeStamp;
                if (timeoutID !== undefined) {
                    clearTimeout(timeoutID);
                }
                ready_down = false;
            }
        })
        document.body.addEventListener('keyup', function(e) {
            if (e.keyCode === 32 && t0 !== undefined) {
                dur = e.timeStamp - t0;
                if (dur < (dit*2.5)) {
                    ditdahs.innerHTML = ditdahs.innerHTML + '.';
                } else {
                    ditdahs.innerHTML = ditdahs.innerHTML + '-';
                };
                timeoutID = setTimeout(interpret_morse,dit*3);
                ready_down = true;
            }
        })

        function interpret_morse() {
            if (morse_dict[ditdahs.innerHTML] !== undefined) {
                interpreted.innerHTML = interpreted.innerHTML + morse_dict[ditdahs.innerHTML];
                ditdahs.innerHTML = '';
                timeoutID = setTimeout(function(){interpreted.innerHTML = interpreted.innerHTML + ' '},dit*4);
            }
        }

    </script>
</html>