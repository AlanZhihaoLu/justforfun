<html>
    <head>
        <title>
            Morse Interpreter
        </title>
    </head>
    <body>
        <div style="display:flex;justify-content:center;align-items:center;font-size:x-large;">
            <span id="interpreted"></span>
            <span id="ditdahs" style='opacity:0.5;'></span>
            <span id="cursor" style='position:relative;top:0.05em;font-size:1.2em;'>|</span>
        </div>
    </body>
    <script src="cursor_blink.js"></script>
    <script>
        var interpreted = document.querySelector('#interpreted');
        var ditdahs = document.querySelector('#ditdahs');

        var morse_dict = {
            '.-':'a',
            '-...':'b',
            '-.-.':'c',
            '-..':'d',
            '.':'e',
            '..-.':'f',
            '--.':'g',
            '....':'h',
            '..':'i',
            '.---':'j',
            '-.-':'k',
            '.-..':'l',
            '--':'m',
            '-.':'n',
            '---':'o',
            '.--.':'p',
            '--.-':'q',
            '.-.':'r',
            '...':'s',
            '-':'t',
            '..-':'u',
            '...-':'v',
            '.--':'w',
            '-..-':'x',
            '-.--':'y',
            '--..':'z',
            '.----':'1',
            '..---':'2',
            '...--':'3',
            '....-':'4',
            '.....':'5',
            '-....':'6',
            '--...':'7',
            '---..':'8',
            '----.':'9',
            '-----':'0'
        }

        var dit = 150;
        ditdahs.innerHTML = '';
        var timeoutID;

        var ready_down = true;
        var t0;
        var dur;

        document.body.addEventListener('keydown', function (e) {
            if (e.keyCode === 8) {
                if (timeoutID !== undefined) {
                    console.log('clearing')
                    clearTimeout(timeoutID);
                    console.log(interpreted.innerHTML)
                    if (ditdahs.innerHTML.length !== 0) {
                        timeoutID = setTimeout(interpret_morse,dit*3);
                        ditdahs.innerHTML = ditdahs.innerHTML.slice(0, -1)
                    } else {
                        interpreted.innerHTML = interpreted.innerHTML.slice(0, -1)
                    }
                }
            }
            if (e.keyCode === 32 && ready_down) {
                t0 = e.timeStamp;
                console.log(ditdahs.innerHTML);
                console.log('down', timeoutID, t0)
                if (timeoutID !== undefined) {
                    console.log('clearing')
                    clearTimeout(timeoutID);
                }
                ready_down = false;
            }
        })
        document.body.addEventListener('keyup', function(e) {
            if (e.keyCode === 32 && t0 !== undefined) {
                dur = e.timeStamp - t0;
                if (dur < (dit*2.5)) {
                    ditdahs.innerHTML = ditdahs.innerHTML + '.';
                } else {
                    ditdahs.innerHTML = ditdahs.innerHTML + '-';
                };
                timeoutID = setTimeout(interpret_morse,dit*3);
                console.log('up',timeoutID,e.timeStamp)
                ready_down = true;
            }
        })

        function interpret_morse() {
            if (morse_dict[ditdahs.innerHTML] !== undefined) {
                interpreted.innerHTML = interpreted.innerHTML + morse_dict[ditdahs.innerHTML];
                ditdahs.innerHTML = '';
                timeoutID = setTimeout(function(){interpreted.innerHTML = interpreted.innerHTML + '&nbsp;'},dit*4);
                console.log('interpret',timeoutID)
            }
        }

    </script>
</html>